<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>EPUB Reader</title>

<!-- epub.js -->
<script src="https://unpkg.com/epubjs/dist/epub.min.js"></script>

<style>
body {
  margin: 0;
  background: #111;
  color: #eee;
  font-family: system-ui, sans-serif;
}

#topbar {
  display: flex;
  gap: 8px;
  padding: 10px;
  background: #1a1a1a;
  position: sticky;
  top: 0;
  z-index: 10;
}

button, select {
  background: #333;
  color: #fff;
  border: none;
  padding: 6px 10px;
  border-radius: 6px;
  font-size: 14px;
}

#reader {
  padding: 16px;
  font-size: 18px;
  line-height: 1.6;
  font-family:
    system-ui,
    -apple-system,
    BlinkMacSystemFont,
    "Segoe UI",
    Roboto,
    "Noto Sans",
    Arial,
    "Times New Roman",
    serif;
}

#settings {
  position: fixed;
  bottom: 12px;
  right: 12px;
  background: #222;
  padding: 12px;
  border-radius: 10px;
  display: none;
  z-index: 99;
  width: 220px;
}

#settings label {
  display: block;
  font-size: 13px;
  margin-bottom: 10px;
}

#settings input,
#settings select {
  width: 100%;
}

img {
  max-width: 100%;
  height: auto;
}
</style>
</head>

<body>

<div id="topbar">
  <input type="file" accept=".epub" onchange="loadEpub(this)">
  <button onclick="prev()">⬅️</button>
  <button onclick="next()">➡️</button>
  <button onclick="toggleSettings()">⚙️</button>
</div>

<div id="reader"></div>

<div id="settings">
  <label>
    Yazı Boyutu
    <input type="range" min="14" max="28" step="1"
           oninput="setFontSize(this.value)">
  </label>

  <label>
    Satır Aralığı
    <input type="range" min="1.2" max="2.2" step="0.1"
           oninput="setLineHeight(this.value)">
  </label>

  <label>
    Kenar Boşluğu
    <input type="range" min="8" max="32" step="2"
           oninput="setPadding(this.value)">
  </label>

  <label>
    Font
    <select onchange="setFont(this.value)">
      <option value="system">Varsayılan</option>
      <option value="times">Times New Roman</option>
      <option value="serif">Serif</option>
      <option value="sans">Sans Serif</option>
    </select>
  </label>
</div>

<script>
let book, rendition;

const reader = document.getElementById("reader");

function loadEpub(input) {
  const file = input.files[0];
  if (!file) return;

  book = ePub(file);
  rendition = book.renderTo("reader", {
    width: "100%",
    height: "100%",
    flow: "scrolled-doc"
  });

  rendition.display(localStorage.getItem("cfi") || undefined);

  rendition.on("relocated", location => {
    localStorage.setItem("cfi", location.start.cfi);
  });

  applySettings();
}

function next() {
  rendition && rendition.next();
}

function prev() {
  rendition && rendition.prev();
}

function toggleSettings() {
  const s = document.getElementById("settings");
  s.style.display = s.style.display === "block" ? "none" : "block";
}

function setFontSize(v) {
  reader.style.fontSize = v + "px";
  localStorage.fontSize = v;
}

function setLineHeight(v) {
  reader.style.lineHeight = v;
  localStorage.lineHeight = v;
}

function setPadding(v) {
  reader.style.padding = v + "px";
  localStorage.padding = v;
}

function setFont(v) {
  let f;
  if (v === "times") {
    f = '"Times New Roman", serif';
  } else if (v === "serif") {
    f = 'serif';
  } else if (v === "sans") {
    f = 'Arial, sans-serif';
  } else {
    f = 'system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans", Arial, sans-serif';
  }
  reader.style.fontFamily = f;
  localStorage.font = v;
}

function applySettings() {
  if (localStorage.fontSize)
    reader.style.fontSize = localStorage.fontSize + "px";
  if (localStorage.lineHeight)
    reader.style.lineHeight = localStorage.lineHeight;
  if (localStorage.padding)
    reader.style.padding = localStorage.padding + "px";
  if (localStorage.font)
    setFont(localStorage.font);
}
</script>

</body>
</html>
